--- 23_html_fallback_routing.sql: resolve_worker_from_request
+++ 24_wildcard_pattern_matching.sql: resolve_worker_from_request
@@ -27,10 +27,15 @@
     -- Priority 1: Direct worker_id (used for service bindings, worker-to-worker calls)
     IF p_worker_id IS NOT NULL THEN
-        v_result.worker_id := p_worker_id;
-        v_result.project_id := NULL;
-        v_result.backend_type := 'worker'::enum_backend_type;
-        v_result.assets_storage_id := NULL;
-        v_result.priority := NULL;
-        RETURN v_result;
+        -- Verify worker exists before returning
+        IF EXISTS (SELECT 1 FROM workers WHERE id = p_worker_id) THEN
+            v_result.worker_id := p_worker_id;
+            v_result.project_id := NULL;
+            v_result.backend_type := 'worker'::enum_backend_type;
+            v_result.assets_storage_id := NULL;
+            v_result.priority := NULL;
+            RETURN v_result;
+        ELSE
+            RETURN NULL;  -- Worker not found
+        END IF;
     END IF;

@@ -70,15 +75,21 @@
         INTO v_route_record
         FROM project_routes
         WHERE project_id = v_project_id_temp
           AND (
-            pattern = p_path
-            OR (pattern LIKE '%/*' AND p_path LIKE REPLACE(pattern, '/*', '') || '%')
+            match_route_pattern(p_path, pattern)
             -- Allow /about.html to match route /about (prerendered fallback)
             OR (p_path LIKE '%.html' AND pattern = REPLACE(p_path, '.html', ''))
           )
-        ORDER BY priority DESC
+        ORDER BY
+          route_pattern_specificity(pattern) DESC,
+          priority DESC
         LIMIT 1;

         IF NOT FOUND THEN
-            RETURN NULL;  -- No route matches
+            -- No route matches, but project exists (should be 404)
+            v_result.project_id := v_project_id_temp;
+            v_result.worker_id := NULL;
+            v_result.backend_type := NULL;
+            v_result.assets_storage_id := NULL;
+            v_result.priority := NULL;
+            RETURN v_result;
         END IF;

